{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://blert.io/schemas/bcf-1.0-strict.schema.json",
  "title": "Blert Chart Format (BCF) 1.0 Strict",
  "type": "object",
  "additionalProperties": false,
  "required": ["version", "config", "timeline"],
  "properties": {
    "version": { "const": "1.0" },
    "name": { "type": "string" },
    "description": { "type": "string" },
    "config": { "$ref": "#/$defs/config" },
    "timeline": { "$ref": "#/$defs/timeline" }
  },

  "$defs": {
    "idString": {
      "type": "string",
      "pattern": "^[A-Za-z0-9_-]+$",
      "description": "URL-safe identifier (alphanumeric, underscore, hyphen)."
    },

    "actionType": {
      "type": "string",
      "pattern": "^[A-Z][A-Z0-9_]*$",
      "description": "UPPER_SNAKE_CASE action type identifier."
    },

    "config": {
      "type": "object",
      "additionalProperties": false,
      "required": ["totalTicks"],
      "properties": {
        "totalTicks": { "type": "integer", "minimum": 1 },
        "startTick": { "type": "integer", "minimum": 0 },
        "endTick": { "type": "integer", "minimum": 0 },
        "rowOrder": {
          "type": "array",
          "items": { "$ref": "#/$defs/idString" },
          "uniqueItems": true,
          "minItems": 1
        }
      }
    },

    "timeline": {
      "type": "object",
      "additionalProperties": false,
      "required": ["actors", "ticks"],
      "properties": {
        "actors": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/$defs/actor" }
        },
        "ticks": {
          "type": "array",
          "items": { "$ref": "#/$defs/tick" }
        },
        "phases": {
          "type": "array",
          "items": { "$ref": "#/$defs/phase" }
        }
      }
    },

    "phase": {
      "type": "object",
      "additionalProperties": false,
      "required": ["tick", "phaseType"],
      "properties": {
        "tick": { "type": "integer", "minimum": 0 },
        "phaseType": { "$ref": "#/$defs/actionType" }
      }
    },

    "actor": {
      "oneOf": [
        { "$ref": "#/$defs/playerActor" },
        { "$ref": "#/$defs/npcActor" }
      ]
    },

    "playerActor": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type", "id", "name"],
      "properties": {
        "type": { "const": "player" },
        "id": { "$ref": "#/$defs/idString" },
        "name": { "type": "string", "minLength": 1 }
      }
    },

    "npcActor": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type", "id", "npcId", "name"],
      "properties": {
        "type": { "const": "npc" },
        "id": { "$ref": "#/$defs/idString" },
        "npcId": { "type": "integer", "minimum": 1 },
        "name": { "type": "string", "minLength": 1 },
        "spawnTick": { "type": "integer", "minimum": 0 },
        "deathTick": { "type": "integer", "minimum": 0 }
      }
    },

    "tick": {
      "type": "object",
      "additionalProperties": false,
      "required": ["tick", "cells"],
      "properties": {
        "tick": { "type": "integer", "minimum": 0 },
        "cells": {
          "type": "array",
          "items": { "$ref": "#/$defs/cell" }
        }
      }
    },

    "cell": {
      "type": "object",
      "additionalProperties": false,
      "required": ["actorId"],
      "properties": {
        "actorId": { "$ref": "#/$defs/idString" },
        "actions": { "$ref": "#/$defs/actions" },
        "state": { "$ref": "#/$defs/state" }
      }
    },

    "actions": {
      "type": "array",
      "items": { "$ref": "#/$defs/action" }
    },

    "action": {
      "oneOf": [
        { "$ref": "#/$defs/attackAction" },
        { "$ref": "#/$defs/spellAction" },
        { "$ref": "#/$defs/utilityAction" },
        { "$ref": "#/$defs/deathAction" },
        { "$ref": "#/$defs/npcAttackAction" },
        { "$ref": "#/$defs/npcPhaseAction" }
      ]
    },

    "attackAction": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type", "attackType"],
      "properties": {
        "type": { "const": "attack" },
        "attackType": { "$ref": "#/$defs/actionType" },
        "weaponId": { "type": "integer", "minimum": 1 },
        "weaponName": { "type": "string" },
        "targetActorId": { "$ref": "#/$defs/idString" },
        "distanceToTarget": { "type": "integer", "minimum": 0 },
        "damage": { "type": "integer", "minimum": 0 },
        "specCost": { "type": "integer", "minimum": 0, "maximum": 100 }
      }
    },

    "spellAction": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type", "spellType"],
      "properties": {
        "type": { "const": "spell" },
        "spellType": { "$ref": "#/$defs/actionType" },
        "targetActorId": { "$ref": "#/$defs/idString" }
      }
    },

    "utilityAction": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type", "utilityType"],
      "properties": {
        "type": { "const": "utility" },
        "utilityType": { "$ref": "#/$defs/actionType" }
      }
    },

    "deathAction": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type"],
      "properties": {
        "type": { "const": "death" }
      }
    },

    "npcAttackAction": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type", "attackType"],
      "properties": {
        "type": { "const": "npcAttack" },
        "attackType": { "$ref": "#/$defs/actionType" },
        "targetActorId": { "$ref": "#/$defs/idString" }
      }
    },

    "npcPhaseAction": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type", "phaseType"],
      "properties": {
        "type": { "const": "npcPhase" },
        "phaseType": { "$ref": "#/$defs/actionType" }
      }
    },

    "state": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "isDead": { "type": "boolean" },
        "offCooldown": { "type": "boolean" },
        "specEnergy": { "type": "integer", "minimum": 0, "maximum": 100 }
      }
    }
  }
}
